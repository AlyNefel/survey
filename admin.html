<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Survey Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
    <style>
        #background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>

    <style>
        body {
            background-color: #121212;
            color: #fff;
            padding: 20px;
            font-family: 'Segoe UI', sans-serif;
        }
        .dashboard-container {
            background: rgba(30, 30, 30, 0.98);
            border-radius: 18px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            padding: 40px 30px 30px 30px;
            margin-top: 40px;
            margin-bottom: 40px;
            max-width: 1100px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #222;
        }
        .chart-wrapper {
            height: 300px;
            margin-bottom: 40px;
        }
        canvas {
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 10px;
        }
        table {
            width: 100%;
            background-color: #1e1e1e;
            color: white;
            border-radius: 10px;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #444;
            vertical-align: middle;
        }
        th {
            background: #232323;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        tr:last-child td {
            border-bottom: none;
        }
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px 5px;
            }
            .chart-wrapper {
                height: 220px;
            }
            th, td {
                padding: 7px;
            }
        }
    </style>
</head>
<body>
    <div id="background-animation"></div>
    <div class="dashboard-container">
        <h1 class="mb-4">ðŸ“Š Survey Results Dashboard</h1>
        <h5>Total Responses: <span id="totalResponses">...</span></h5>

        <div class="chart-wrapper">
            <h4>Last Package Issue</h4>
            <canvas id="packageChart"></canvas>
        </div>

        <div class="chart-wrapper">
            <h4>Current Delivery Setup</h4>
            <canvas id="setupChart"></canvas>
        </div>

        <div class="chart-wrapper">
            <h4>Looked for Security Products</h4>
            <canvas id="productChart"></canvas>
        </div>

        <h4>Detailed Responses</h4>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Last Issue</th>
                        <th>Current Setup</th>
                        <th>Looked for Products</th>
                        <th>Products Considered</th>
                        <th>Choice of Card</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="responseTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        axios.get('http://localhost:5000/api/admin/responses')
            .then(res => {
                const responses = res.data;
                document.getElementById("totalResponses").textContent = responses.length;

                // Chart data
                const issueLabels = ['Never', 'Within last month', '1â€“3 months ago', 'Over 3 months ago'];
                const issueCounts = issueLabels.map(label =>
                    responses.filter(r => r.lastPackageIssue === label).length
                );

                const setupLabels = [
                    "I'm usually home",
                    "Porch/doorstep with no security",
                    "I use a lockbox or other device",
                    "I leave instructions for the courier",
                    "Other"
                ];
                const setupCounts = setupLabels.map(label =>
                    responses.filter(r => r.currentSetup === label).length
                );

                const productLabels = ['Yes', 'No'];
                const productCounts = productLabels.map(label =>
                    responses.filter(r => r.lookedForProducts === label).length
                );

                new Chart(document.getElementById("packageChart"), {
                    type: 'pie',
                    data: {
                        labels: issueLabels,
                        datasets: [{
                            data: issueCounts,
                            backgroundColor: ['#4bc0c0', '#ff6384', '#36a2eb', '#ffce56']
                        }]
                    }
                });

                new Chart(document.getElementById("setupChart"), {
                    type: 'bar',
                    data: {
                        labels: setupLabels,
                        datasets: [{
                            data: setupCounts,
                            label: 'Delivery Setup',
                            backgroundColor: '#9966ff'
                        }]
                    },
                    options: { responsive: true }
                });

                new Chart(document.getElementById("productChart"), {
                    type: 'pie',
                    data: {
                        labels: productLabels,
                        datasets: [{
                            data: productCounts,
                            backgroundColor: ['#36a2eb', '#ff6384']
                        }]
                    }
                });

                const tableBody = document.getElementById("responseTableBody");
                responses.forEach(r => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${r.email || 'N/A'}</td>
                        <td>${r.lastPackageIssue}</td>
                        <td>${r.currentSetup}${r.otherSetupDescription ? ` (${r.otherSetupDescription})` : ''}</td>
                        <td>${r.lookedForProducts}</td>
                        <td>${r.productConsiderations || 'N/A'}</td>
                        <td>${r.giftCardChoice || 'N/A'}</td>
                        <td>${new Date(r.createdAt).toLocaleDateString()}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(err => {
                console.error("Error loading data", err);
            });
    </script>
    <script>
        let vantaEffect;
        function setVanta(effectName) {
            if (vantaEffect) vantaEffect.destroy();
            switch(effectName) {
                case 'net':
                    vantaEffect = VANTA.NET({ el: "#background-animation", mouseControls: true, touchControls: true, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, color: 0x2196f3, backgroundColor: 0x121212 });
                    break;
                case 'waves':
                    vantaEffect = VANTA.WAVES({ el: "#background-animation", mouseControls: true, touchControls: true, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, color: 0x2196f3, shininess: 50, waveHeight: 20, waveSpeed: 1, backgroundColor: 0x121212 });
                    break;
                case 'birds':
                    vantaEffect = VANTA.BIRDS({ el: "#background-animation", mouseControls: true, touchControls: true, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, backgroundColor: 0x121212, color1: 0x2196f3, color2: 0x90caf9 });
                    break;
            }
        }
        setVanta('net'); // Change 'net' to 'waves' or 'birds' to test other effects
    </script>
</body>
</html>
